<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Footprints - music history dashboard</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <header class="masthead">
        <div class="brand">
            <div class="eyebrow">Footprints</div>
            <h1>Listening control room</h1>
            <p class="subtitle">Utilitarian grids and charts you can poke at.</p>
        </div>
        <div class="pill">
            <div class="label">Active period</div>
            <div class="value" id="activePeriodLabel">All Time</div>
        </div>
    </header>

    <div class="tabs" id="tabButtons">
        <button class="tab active" data-tab="overview">Overview</button>
        <button class="tab" data-tab="timeline">Timeline</button>
        <button class="tab" data-tab="heatmap">Heatmap</button>
        <button class="tab" data-tab="novelty">Novelty</button>
        <button class="tab" data-tab="transitions">Transitions</button>
        <button class="tab" data-tab="diversity">Diversity</button>
        <button class="tab" data-tab="yearly">Yearly</button>
        <button class="tab" data-tab="import">Import</button>
    </div>

    <div class="panel">
        <div class="controls">
            <div class="time-selector">
                <button class="time-btn active" data-period="alltime">All Time</button>
                <button class="time-btn" data-period="year">This Year</button>
                <button class="time-btn" data-period="month">This Month</button>
                <button class="time-btn" data-period="week">This Week</button>
                <button class="time-btn" data-period="today">Today</button>
                <button class="time-btn" data-period="custom">Custom‚Ä¶</button>
            </div>
            <div class="custom-range" id="customRange" style="display:none;">
                <label>Start <input type="date" id="customStart"></label>
                <label>End <input type="date" id="customEnd"></label>
                <button class="ghost" onclick="applyCustomRange()">Apply custom range</button>
                <div id="customRangeMessage" class="muted"></div>
            </div>
            <div class="stat-row">
                <div class="stat-block">
                    <div class="stat-label">Total scrobbles</div>
                    <div class="stat-value" id="totalScrobbles">-</div>
                </div>
                <div class="stat-block">
                    <div class="stat-label">Scrobbles in view</div>
                    <div class="stat-value" id="periodScrobbles">-</div>
                </div>
            </div>

        </div>
    </div>

    <div id="overview" class="tab-content active">
        <div class="panel">
            <div class="panel-heading">
                <h2>Top Artists</h2>
                <span class="muted">Based on selected period</span>
            </div>
            <div class="top-grid" id="topArtistsGrid">
                <div class="loading-state">Loading...</div>
            </div>
        </div>

        <div class="panel">
            <div class="panel-heading">
                <h2>Top Albums</h2>
                <span class="muted">Based on selected period</span>
            </div>
            <div class="top-grid" id="topAlbumsGrid">
                <div class="loading-state">Loading...</div>
            </div>
        </div>

        <div class="panel">
            <div class="panel-heading">
                <h2>Top Tracks</h2>
                <span class="muted">Based on selected period</span>
            </div>
            <div class="top-grid" id="topTracksGrid">
                <div class="loading-state">Loading...</div>
            </div>
        </div>
    </div>

    <div id="timeline" class="tab-content">
        <div class="panel">
            <div class="panel-heading">
                <h2>Recent scrobbles</h2>
                <span class="muted">Latest 50 per page</span>
            </div>
            <div id="timelineList">
                <div class="loading">Loading...</div>
            </div>
            <div class="inline-actions" style="align-items: center; gap: 12px;">
                <button class="ghost" onclick="goToFirstPage()" id="firstPageBtn" disabled>First</button>
                <button class="ghost" onclick="goToPrevPage()" id="prevPageBtn" disabled>Previous</button>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span class="muted">Page</span>
                    <input type="number" id="pageInput" value="1" min="1" style="width: 70px; text-align: center;">
                    <span class="muted" id="pageInfo">of ?</span>
                    <button class="ghost" onclick="goToPage()" style="padding: 8px 12px;">Go</button>
                </div>
                <button class="ghost" onclick="goToNextPage()" id="nextPageBtn">Next</button>
                <button class="ghost" onclick="goToLastPage()" id="lastPageBtn">Last</button>
            </div>
        </div>
    </div>

    <!-- Heatmap Tab -->
    <div id="heatmap" class="tab-content">
        <div class="panel">
            <div class="panel-heading">
                <h2>üî• Time-of-Day Heatmap</h2>
                <span class="muted">When do you listen to music most?</span>
            </div>

            <div class="feature-controls">
                <label>
                    <span>Timezone:</span>
                    <select id="heatmapTimezone">
                        <option value="UTC">UTC</option>
                        <option value="America/New_York">US Eastern</option>
                        <option value="America/Chicago">US Central</option>
                        <option value="America/Denver">US Mountain</option>
                        <option value="America/Los_Angeles">US Pacific</option>
                        <option value="Europe/London">London</option>
                        <option value="Europe/Paris">Paris</option>
                        <option value="Europe/Berlin">Berlin</option>
                        <option value="Asia/Tokyo">Tokyo</option>
                        <option value="Asia/Shanghai">Shanghai</option>
                        <option value="Australia/Sydney">Sydney</option>
                    </select>
                </label>
                <label>
                    <input type="checkbox" id="heatmapNormalize">
                    <span>Normalize (show percentages)</span>
                </label>
                <button onclick="loadHeatmapReport()">üî• Generate Heatmap</button>
            </div>

            <div id="heatmapMessage"></div>
            <div id="heatmapSummary"></div>
            <div id="heatmapViz"></div>
        </div>
    </div>

    <!-- Diversity Tab -->
    <div id="diversity" class="tab-content">
        <div class="panel">
            <div class="panel-heading">
                <h2>üìä Diversity & Entropy Trend</h2>
                <span class="muted">Measure how diverse your listening is over time</span>
            </div>

            <div class="feature-controls">
                <label>
                    <span>Granularity:</span>
                    <select id="diversityGranularity">
                        <option value="day">Day</option>
                        <option value="week" selected>Week</option>
                        <option value="month">Month</option>
                    </select>
                </label>
                <button onclick="loadDiversityReport()">üìä Analyze Diversity</button>
            </div>

            <div id="diversityMessage"></div>
            <div id="diversitySummary"></div>
            <div id="diversityTimeline"></div>
        </div>
    </div>

    <!-- Yearly Report Tab -->
    <div id="yearly" class="tab-content">
        <div class="panel">
            <div class="panel-heading">
                <h2>üéâ Yearly Report (Wrapped)</h2>
                <span class="muted">Your year in music, Spotify Wrapped style</span>
            </div>

            <div class="feature-controls">
                <label>
                    <span>Year:</span>
                    <select id="yearlyYear"></select>
                </label>
                <button onclick="loadYearlyReport()">üéâ Generate Report</button>
            </div>

            <div id="yearlyMessage"></div>
            <div id="yearlyContent"></div>
        </div>
    </div>

    <div id="import" class="tab-content">
        <!-- Automatic Sync Section -->
        <div class="panel">
            <div class="panel-heading">
                <h2>üîÑ Automatic Sync</h2>
                <span class="muted">Keep your history synchronized automatically</span>
            </div>
            <div id="syncMessage"></div>

            <!-- Sync Configuration List -->
            <div id="syncConfigList">
                <div class="loading-state">Loading sync configurations...</div>
            </div>

            <!-- Add New Sync Config Form -->
            <details class="add-sync-form">
                <summary><strong>‚ûï Add New Sync Configuration</strong></summary>
                <div style="margin-top: 12px;">
                    <h3>Last.fm Auto-Sync</h3>
                    <div class="report-grid">
                        <input type="text" id="syncLastfmUsername" placeholder="Last.fm username">
                        <input type="text" id="syncLastfmApiKey" placeholder="Last.fm API key">
                        <input type="number" id="syncLastfmInterval" placeholder="Sync interval (minutes)" value="60" min="15" max="1440">
                        <button onclick="addSyncConfig('lastfm')" id="addSyncLastfmBtn">Add Last.fm Sync</button>
                    </div>

                    <h3>ListenBrainz Auto-Sync</h3>
                    <div class="report-grid">
                        <input type="text" id="syncLbUsername" placeholder="ListenBrainz username">
                        <input type="text" id="syncLbToken" placeholder="ListenBrainz token (optional)">
                        <input type="number" id="syncLbInterval" placeholder="Sync interval (minutes)" value="60" min="15" max="1440">
                        <button onclick="addSyncConfig('listenbrainz')" id="addSyncLbBtn">Add ListenBrainz Sync</button>
                    </div>
                </div>
            </details>
        </div>

        <!-- One-Time Import Section -->
        <div class="panel">
            <div class="panel-heading">
                <h2>üì• One-Time Import</h2>
                <span class="muted">Pull all history from Last.fm or ListenBrainz</span>
            </div>
            <div id="importMessage"></div>
            <h3>Last.fm</h3>
            <div class="report-grid">
                <input type="text" id="lastfmUsername" placeholder="Last.fm username">
                <input type="text" id="lastfmApiKey" placeholder="Last.fm API key">
                <button onclick="importLastFm()" id="lastfmBtn">Import from Last.fm</button>
            </div>
            <h3>ListenBrainz</h3>
            <div class="report-grid">
                <input type="text" id="lbUsername" placeholder="ListenBrainz username">
                <input type="text" id="lbToken" placeholder="ListenBrainz token (optional)">
                <button onclick="importListenBrainz()" id="lbBtn">Import from ListenBrainz</button>
            </div>
        </div>

        <!-- Export Section -->
        <div class="panel">
            <div class="panel-heading">
                <h2>üì§ Export Data</h2>
                <span class="muted">Download your scrobble history</span>
            </div>
            <div id="exportMessage"></div>
            <div class="report-grid">
                <button onclick="exportData('json')" id="exportJsonBtn">Export as JSON</button>
                <button onclick="exportData('csv')" id="exportCsvBtn">Export as CSV</button>
            </div>
        </div>
    </div>

    <!-- Novelty Tab -->
    <div id="novelty" class="tab-content">
        <div class="panel">
            <div class="panel-heading">
                <h2>üÜï Novelty vs. Re-listen</h2>
                <span class="muted">Track your musical exploration over time</span>
            </div>

            <div class="feature-controls">
                <label>
                    <span>Granularity:</span>
                    <select id="noveltyGranularity">
                        <option value="day">Daily</option>
                        <option value="week" selected>Weekly</option>
                        <option value="month">Monthly</option>
                        <option value="year">Yearly</option>
                    </select>
                </label>
                <button onclick="loadNoveltyReport()">üìä Generate Report</button>
            </div>

            <div id="noveltyMessage"></div>
            <div id="noveltySummary"></div>
            <div id="noveltyTimeline"></div>
            <div id="noveltyDiscoveries"></div>
        </div>
    </div>

    <!-- Transitions Tab -->
    <div id="transitions" class="tab-content">
        <div class="panel">
            <div class="panel-heading">
                <h2>üîÄ Artist Transitions</h2>
                <span class="muted">Discover how artists flow into each other</span>
            </div>

            <div class="feature-controls">
                <label>
                    <span>Gap (minutes):</span>
                    <input type="number" id="transitionsGap" value="45" min="5" max="120">
                </label>
                <label>
                    <span>Min count:</span>
                    <input type="number" id="transitionsMinCount" value="2" min="1" max="10">
                </label>
                <label>
                    <input type="checkbox" id="transitionsSelfTransitions">
                    <span>Include self-transitions</span>
                </label>
                <button onclick="loadTransitionsReport()">üîç Analyze Transitions</button>
            </div>

            <div id="transitionsMessage"></div>
            <div id="transitionsSummary"></div>
            <div id="transitionsTop"></div>
            <div id="transitionsNetwork"></div>
        </div>
    </div>

    <script src="/scripts.js"></script>
</body>
</html>
